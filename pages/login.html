<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/styles/login_styles.css"></link>
    
    <!-- ICON SDK JS is required by Ancilia -->
    <script src="https://cdn.jsdelivr.net/gh/icon-project/icon-sdk-js@latest/build/icon-sdk-js.min.js"></script>
    <!-- Ancilia is required by SpeakyTo -->
    <script src="/scripts/Ancilia.js"></script>
    <script src="/scripts/SpeakyTo.js"></script>

    <!-- iso_639-1 is required by render purposes -->
    <script src="/scripts/iso_639-1.js"></script>

    <!-- JQuery is required by render purposes -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
        // SpeakyTo constants
        const NETWORK = IconNetworks.YEOUIDO
        const ICONTRANSLATE_SCORE = 'cxce93fd34c4ebb9f6a0c38dd2cb0a5cf2b757c189'

        // Instanciate Ancilia + SpeakyTo
        const ancilia = new Ancilia(NETWORK)
        const speakyto = new SpeakyTo(ancilia, ICONTRANSLATE_SCORE)
    </script>
    
    </head>

    <body>
        <div id="main-container">
            <div id="page-contents">
                <div id="login-box">
                    <img id="avatar" src="/images/avatar.png">
                    <p>Login</p>
                    <h3>Use The ICONex Chrome Extension</h3>
                    <button id="login-button" onclick="onLogin()">Login</button>
                    <p>Don't have the ICONex extension? Install <a href="https://chrome.google.com/webstore/detail/iconex/flpiciilemghbmfalicajoolhkkenfel?hl=en">here</a></p>
                </div>
            </div>
        </div> 
        <script>
        window.onload = () => {
            // init account
            accountRefresh()
        }
        
        function accountRefresh() {
            
            if (ancilia.isLoggedIn()) {
                const address = ancilia.getLoggedInWallet()
                $("auth").html('Redirecting To Login Page')
                
            } else {
                
                $("#auth").html('Checking Login')

            }
        }
            
           function onLogin() {
            if (ancilia.isLoggedIn()) {
                //ancilia.logout()
                $("login-button").html('Redirecting...')
                window.location.replace("/pages/qa_home.html")
                accountRefresh()
            }
            else {
                ancilia.login().then(address => {
                    $("login-button").html('Login')
                    window.location.replace("/pages/qa_home.html")
                    accountRefresh()
                })
            }
        } 
            
        </script>
    </body>
    
</html>